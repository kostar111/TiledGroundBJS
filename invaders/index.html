<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>CreateGround tests</title>
    <style>
       html, body, div, canvas {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        canvas {
            display:block;
        }

    </style>
    <!-- JQuery-->
    <script src="lib/jquery-1.10.2.js"></script>
    
    <!-- BABYLON-->
    <script src="lib/babylon.1.12.js"></script>
    <script src="createTiledGround.js"></script>

</head>

 <body>
    <div id="rootDiv">
        <canvas id="canvas_renderer"></canvas>
    </div>

    <script>
    $(function() {
        // Get the Canvas element from our HTML below
        var canvas = document.getElementById("canvas_renderer");
        // Load BABYLON 3D engine
        var engine = new BABYLON.Engine(canvas, true);
        window.addEventListener("resize", function () {
            engine.resize();
        });

        // Scene
        var scene = new BABYLON.Scene(engine);
        // Camera
        var camera = init_camera(scene);
        
        camera.attachControl(canvas);
        // Light
        var light = new BABYLON.HemisphericLight("Hemi0", new BABYLON.Vector3(200, 200, 0), scene);
        ////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////

        // Creation of tileGround
        var xmin = -6.5;
        var zmin = -5.5;
        var xmax = 6.5;
        var zmax = 5.5;
        var precision = {
            "w" : 1,
            "h" : 1
        };
        var subdivisions = {
            'h' : 11,
            'w' : 13
        };
        var vData = createTiledGround(xmin, zmin, xmax, zmax, precision, subdivisions);
        var ground = new BABYLON.Mesh("ground", scene);
        vData.applyToMesh(ground);

        // Create Multi Material
        var backroungMaterial = new BABYLON.StandardMaterial("black", scene);
        backroungMaterial.diffuseColor = new BABYLON.Color3(0, 0, 0);
        //~ backroungMaterial.wireframe = true;

        var invadersMaterial = new BABYLON.StandardMaterial("Black", scene);
        invadersMaterial.diffuseColor = new BABYLON.Color3(0.6, 0, 0.6);

        var multimat = new BABYLON.MultiMaterial("multi", scene);
        multimat.subMaterials.push(backroungMaterial);
        multimat.subMaterials.push(invadersMaterial);
        ground.material = multimat;

        // Apply Multi Material
        ground.subMeshes = [];
        var verticesCount = ground.getTotalVertices();

        var tileIndicesLength = 6 * precision.w * precision.h;
        var base = 0;
        for (var row = 0; row < subdivisions.h; row++) {
            for (var col = 0; col < subdivisions.w; col++) {
                if (isInvaderPosition(row, col))
                    ground.subMeshes.push(new BABYLON.SubMesh(1, 0, verticesCount, base , tileIndicesLength, ground));
                else
                    ground.subMeshes.push(new BABYLON.SubMesh(0, 0, verticesCount, base , tileIndicesLength, ground));
                base += tileIndicesLength;
            }
        }
        
        function isInvaderPosition (row, col) {
            for (var it in invaderCoordinates) {
            if (col == invaderCoordinates[it][0]-1 && row == invaderCoordinates[it][1]-1)
                return true;
            }
        };
        ////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////
        // Once the scene is loaded, just register a render loop to render it
        engine.runRenderLoop(function () {
            scene.render();
        });
    });
    </script>
 </body>
 
 <script>
    function init_camera(scene){
        var camera  = new BABYLON.ArcRotateCamera("Camera", -Math.PI/2, 0, 20, BABYLON.Vector3.Zero(), scene);
        camera.checkCollisions = true;
        camera.maxZ = 10000;
        camera.speed = 5;
        camera.wheelPrecision = 20;
        camera.lowerRadiusLimit = 1;
        camera.keysUp = [90]; // Touche Z
        camera.keysDown = [83]; // Touche S
        camera.keysLeft = [81]; // Touche Q
        camera.keysRight = [68]; // Touche D
        return camera;
    }
    
    
    var invaderCoordinates = [
        [2, 3],
        [2, 4],
        [2, 5],
        
        [3, 5],
        [3, 6],
        
        [4, 3],
        [4, 4],
        [4, 5],
        [4, 6],
        [4, 7],
        [4, 9],
        
        [5, 2],
        [5, 4],
        [5, 5],
        [5, 7],
        [5, 8],
        
        [6, 2],
        [6, 4],
        [6, 5],
        [6, 6],
        [6, 7],
        
        [7, 4],
        [7, 5],
        [7, 6],
        [7, 7],

        [8, 2],
        [8, 4],
        [8, 5],
        [8, 6],
        [8, 7],
        
        [9, 2],
        [9, 4],
        [9, 5],
        [9, 7],
        [9, 8],
        
        [10, 3],
        [10, 4],
        [10, 5],
        [10, 6],
        [10, 7],
        [10, 9],
        
        [11, 5],
        [11, 6],
        
        [12, 3],
        [12, 4],
        [12, 5],
    ];
 </script>


 
 
 
</html>
